秒杀系统设计

1.抗住并发，实现高可用
限流

（1）合法性限流
  防止机器  验证码
  秒杀到了时间再给出下单地址
  IP限制 比如监测到了购买某件商品在毫秒级别或者反复购买同一件商品 就可以限制ip 限制ip可以做在网关层 比如nginx等
  
  
 (2) 多层负载
   LVS 第四层  nginx 第7层
   nginx：七层负载均衡，可以采用keepalived+nginx主备高可用部署方式
   
  
（3）服务限流
   比如 Tomcat最大连接数限制
   编写算法限流  令牌桶算法 漏桶算法
   使用第三方实现  Guava  RateLimit  tryRequire 
   队列限流
     使用可堆积的消息队列或者内存消息队列。请求先进队列，库存都扣减完之后，剩余的请求直接做秒杀失败处理。

     内存队列：可以选用disruptor
     其他：kafka、rocketmq等
   
 
 (4) 缓存限流 减少用户请求服务端数量 减少打到数据库数量
 静态资源保存在CDN
       此处还可以做一些优化，比如：
       
       图片压缩：采用tinypng等格式，减少图片下载所占用的流量
       根据客户端类型（PC还是手机客户端），请求不同尺寸的图片
       客户端拉取图片后，本地也可以做图片缓存
       CDN本身可以分层，此处可以参考 阿里《技术人的百宝黑皮书》
       

 redis缓存预热
 可以使用内存或是内存数据网格（Hazelcast/Gemfire/Apache Ignite等）。
 保存库存数据，秒杀前将库存写入到内存或是内存数据网格，预热。避免了分布式锁，能提升不少性能。
 秒杀业务逻辑每次将内存中的库存进行增加后，可以直接返回，在秒杀业务逻辑返回前提交一个异步任务进行处理、保证mysql中的数据与内存中的数据最终一致性。、
 
 

（5）高可用举措
 数据库独立部署，防止影响其他业务
 集群部署
 服务降级
 动态监测cpu利用率等，动态自动设计部分服务不可用
 
 
 参考
 https://github.com/qiurunze123/miaosha
 
